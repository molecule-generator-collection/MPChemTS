reaction_patterns = (
    ('[n+;H]','n'),  # Imidazoles
    ('[N+;!H0]','N'),  # Amines
    ('[$([O-]);!$([O-][#7])]','O'),  # Carboxylic acids and alcohols
    ('[S-;X1]','S'),  # Thiols
    ('[$([N-;X2]S(=O)=O)]','N'),  # Sulfonamides
    ('[$([N-;X2][C,N]=C)]','N'),  # Enamines
    ('[n-]','[nH]'),  # Tetrazoles
    ('[$([S-]=O)]','S'),  # Sulfoxides
    ('[$([N-]C=O)]','N'),  # Amides
    )

rawD = [
    ('sLi', '[LiD1]-*'),
    ('ssBe', '[BeD2](-*)-*'),
    ('ssssBe', '[BeD4](-*)(-*)(-*)-*'),
    ('ssBH', '[BD2H](-*)-*'),
    ('sssB', '[BD3](-*)(-*)-*'),
    ('ssssB', '[BD4](-*)(-*)(-*)-*'),
    ('sCH3', '[CD1H3]-*'),
    ('dCH2', '[CD1H2]=*'),
    ('ssCH2', '[CD2H2](-*)-*'),
    ('tCH', '[CD1H]#*'),
    ('dsCH', '[CD2H](=*)-*'),
    ('aaCH', '[C,c;D2H](:*):*'),
    ('sssCH', '[CD3H](-*)(-*)-*'),
    ('ddC', '[CD2H0](=*)=*'),
    ('tsC', '[CD2H0](#*)-*'),
    #('dssC', '[CD3H0](=*)(-*)-*'),
    ('dssC', '[C,c;D3H0](=*)(~*)~*'),
    ('aasC', '[C,c;D3H0](:*)(:*)-*'),
    ('aaaC', '[C,c;D3H0](:*)(:*):*'),
    ('ssssC', '[CD4H0](-*)(-*)(-*)-*'),
    ('sNH3', '[ND1H3]-*'),
    ('sNH2', '[ND1H2]-*'),
    ('ssNH2', '[ND2H2](-*)-*'),
    ('dNH', '[ND1H]=*'),
    ('ssNH', '[ND2H](-*)-*'),
    ('aaNH', '[N,nD2H](:*):*'),
    ('tN', '[ND1H0]#*'),
    ('sssNH', '[ND3H](-*)(-*)-*'),
    ('dsN', '[ND2H0](=*)-*'),
    ('aaN', '[N,nD2H0](:*):*'),
    ('sssN', '[ND3H0](-*)(-*)-*'),
    ('ddsN', '[ND3H0](~[OD1H0])(~[OD1H0])-,:*'),  # mod
    ('aasN', '[N,nD3H0](:*)(:*)-,:*'),  # mod
    ('ssssN', '[ND4H0](-*)(-*)(-*)-*'),
    ('sOH', '[OD1H]-*'),
    #('dO', '[OD1H0]=*'),
    ('dO', '[$([OD1H0]=*),$([OD1H0-]-[*+])]'),
    ('ssO', '[OD2H0](-*)-*'),
    ('aaO', '[O,oD2H0](:*):*'),
    ('sF', '[FD1]-*'),
    ('sSiH3', '[SiD1H3]-*'),
    ('ssSiH2', '[SiD2H2](-*)-*'),
    ('sssSiH', '[SiD3H1](-*)(-*)-*'),
    ('ssssSi', '[SiD4H0](-*)(-*)(-*)-*'),
    ('sPH2', '[PD1H2]-*'),
    ('ssPH', '[PD2H1](-*)-*'),
    ('sssP', '[PD3H0](-*)(-*)-*'),
    ('dsssP', '[PD4H0](=*)(-*)(-*)-*'),
    ('sssssP', '[PD5H0](-*)(-*)(-*)(-*)-*'),
    ('sSH', '[SD1H1]-*'),
    ('dS', '[SD1H0]=*'),
    ('ssS', '[SD2H0](-*)-*'),
    ('aaS', '[S,sD2H0](:*):*'),
    ('dssS', '[SD3H0](=*)(-*)-*'),
    ('ddssS', '[SD4H0](~[OD1H0])(~[OD1H0])(-*)-*'),  # mod
    ('sCl', '[ClD1]-*'),
    ('sGeH3', '[GeD1H3](-*)'),
    ('ssGeH2', '[GeD2H2](-*)-*'),
    ('sssGeH', '[GeD3H1](-*)(-*)-*'),
    ('ssssGe', '[GeD4H0](-*)(-*)(-*)-*'),
    ('sAsH2', '[AsD1H2]-*'),
    ('ssAsH', '[AsD2H1](-*)-*'),
    ('sssAs', '[AsD3H0](-*)(-*)-*'),
    ('sssdAs', '[AsD4H0](=*)(-*)(-*)-*'),
    ('sssssAs', '[AsD5H0](-*)(-*)(-*)(-*)-*'),
    ('sSeH', '[SeD1H1]-*'),
    ('dSe', '[SeD1H0]=*'),
    ('ssSe', '[SeD2H0](-*)-*'),
    ('aaSe', '[SeD2H0](:*):*'),
    ('dssSe', '[SeD3H0](=*)(-*)-*'),
    ('ddssSe', '[SeD4H0](=*)(=*)(-*)-*'),
    ('sBr', '[BrD1]-*'),
    ('sSnH3', '[SnD1H3]-*'),
    ('ssSnH2', '[SnD2H2](-*)-*'),
    ('sssSnH', '[SnD3H1](-*)(-*)-*'),
    ('ssssSn', '[SnD4H0](-*)(-*)(-*)-*'),
    ('sI', '[ID1]-*'),
    ('sPbH3', '[PbD1H3]-*'),
    ('ssPbH2', '[PbD2H2](-*)-*'),
    ('sssPbH', '[PbD3H1](-*)(-*)-*'),
    ('ssssPb', '[PbD4H0](-*)(-*)(-*)-*'),
    ]

aEstate = {
    'sLi': 0,
    'ssBe': 1,
    'ssssBe': 2,
    'ssBH': 3,
    'sssB': 4,
    'ssssB': 5,
    'sCH3': 6,
    'dCH2': 7,
    'ssCH2': 8,
    'tCH': 9,
    'dsCH': 10,
    'aaCH': 11,
    'sssCH': 12,
    'ddC': 13,
    'tsC': 14,
    'dssC': 15,
    'aasC': 16,
    'aaaC': 17,
    'ssssC': 18,
    'sNH3': 19,
    'sNH2': 20,
    'ssNH2': 21,
    'dNH': 22,
    'ssNH': 23,
    'aaNH': 24,
    'tN': 25,
    'sssNH': 26,
    'dsN': 27,
    'aaN': 28,
    'sssN': 29,
    'ddsN': 30,
    'aasN': 31,
    'ssssN': 32,
    'sOH': 33,
    'dO': 34,
    'ssO': 35,
    'aaO': 36,
    'sF': 37,
    'sSiH3': 38,
    'ssSiH2': 39,
    'sssSiH': 40,
    'ssssSi': 41,
    'sPH2': 42,
    'ssPH': 43,
    'sssP': 44,
    'dsssP': 45,
    'sssssP': 46,
    'sSH': 47,
    'dS': 48,
    'ssS': 49,
    'aaS': 50,
    'dssS': 51,
    'ddssS': 52,
    'sCl': 53,
    'sGeH3': 54,
    'ssGeH2': 55,
    'sssGeH': 56,
    'ssssGe': 57,
    'sAsH2': 58,
    'ssAsH': 59,
    'sssAs': 60,
    'sssdAs': 61,
    'sssssAs': 62,
    'sSeH': 63,
    'dSe': 64,
    'ssSe': 65,
    'aaSe': 66,
    'dssSe': 67,
    'ddssSe': 68,
    'sBr': 69,
    'sSnH3': 70,
    'ssSnH2': 71,
    'sssSnH': 72,
    'ssssSn': 73,
    'sI': 74,
    'sPbH3': 75,
    'ssPbH2': 76,
    'sssPbH': 77,
    'ssssPb': 78
    }


atEstate = {
    'sLi': -1,
    'ssBe': -1,
    'ssssBe': -1,
    'ssBH': -1,
    'sssB': -1,
    'ssssB': -1,
    'sCH3': 1,
    'dCH2': 2,
    'ssCH2': 1,
    'tCH': 3,
    'dsCH': 2,
    'aaCH': 2,
    'sssCH': 1,
    'ddC': 4,
    'tsC': 3,
    'dssC': 2,
    'aasC': 2,
    'aaaC': 2,
    'ssssC': 1,
    'sNH3': 5,
    'sNH2': 5,
    'ssNH2': 5,
    'dNH': 7,
    'ssNH': 5,
    'aaNH': 8,
    'tN': 10,
    'sssNH': 5,
    'dsN': 7,
    'aaN': 8,
    'sssN': 5,
    'ddsN': 9,
    'aasN': 8,
    'ssssN': 6,
    'sOH': 11,
    'dO': 12,
    'ssO': 11,
    'aaO': 13,
    'sF': 14,
    'sSiH3': -1,
    'ssSiH2': -1,
    'sssSiH': -1,
    'ssssSi': -1,
    'sPH2': 15,
    'ssPH': 15,
    'sssP': 15,
    'dsssP': 15,
    'sssssP': 15,
    'sSH': 16,
    'dS': 19,
    'ssS': 16,
    'aaS': 17,
    'dssS': 18,
    'ddssS': 18,
    'sCl': 14,
    'sGeH3': -1,
    'ssGeH2': -1,
    'sssGeH': -1,
    'ssssGe': -1,
    'sAsH2': -1,
    'ssAsH': -1,
    'sssAs': -1,
    'sssdAs': -1,
    'sssssAs': -1,
    'sSeH': -1,
    'dSe': -1,
    'ssSe': -1,
    'aaSe': -1,
    'dssSe': -1,
    'ddssSe': -1,
    'sBr': 20,
    'sSnH3': -1,
    'ssSnH2': -1,
    'sssSnH': -1,
    'ssssSn': -1,
    'sI': 21,
    'sPbH3': -1,
    'ssPbH2': -1,
    'sssPbH': -1,
    'ssssPb': -1
    }